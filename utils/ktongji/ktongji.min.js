var ktj={j:"https://alog.kuaiyq.com/a/v1/track",o:"ktj",a:"2.1.2",r:"",h:"",d:"",_:"",l:"",g:"",w:"",m:"",A:"",P:"",y:"",T:"",networkType:"",x:{},I:{},userInfo:{},S:null,U:null,D:null,H:"",O:0,L:0,F:"",K:!1,M:["_ktj_apperror","_ktj_pageload","_ktj_pageshow","_ktj_pageexit"],b:["_ktj_launch","_ktj_appshow","_ktj_apphide"],C:!1,init:function(t,n){this.J=t,this.A=this.N(),this.S=Date.now(),this.R(),n?(this.F=n,this.C=!0,this.q()):(this.V(),this.B())},disableAntiFraudDetection:function(){this.K=!0},disableAllAntiFraudDetection:function(){this.K=!0,this.M=this.M.concat(this.b)},G:function(){return this.h},V:function(){if(void 0!=wx.navigateToMiniProgram){var t=wx.navigateToMiniProgram;Object.defineProperty(wx,"navigateToMiniProgram",{value:function(){var n=arguments[0];return n.path=ktj.appendUserIdToPath(n.path),ktj.Q(n,"success",function(){var t=ktj.X({e:"_ktj_tomp",p:{ai:n.appId,pt:n.path,ed:n.extraData},u:ktj.userInfo,si:ktj.I,lo:ktj.Y(ktj.x)});ktj.z(t)}),t.apply(wx,arguments)},writable:!1})}},B:function(){var t=this,n=App;App=function(k){t.Q(k,"onLaunch",t.W),t.Q(k,"onShow",t.Z),t.Q(k,"onHide",t.$),t.Q(k,"onError",t.tt),n(k)};var k=Page;Page=function(n){t.Q(n,"onLoad",t.nt),t.Q(n,"onShow",t.kt),t.Q(n,"onHide",t.it),t.Q(n,"onUnload",t.it),void 0!==n.onShareAppMessage&&t.jt(n,"onShareAppMessage",t.et),k(n)}},q:function(){var t=this,n=App;App=function(k){t.Q(k,"onLaunch",t.W),t.Q(k,"onShow",t.Z),n(k)}},Q:function(t,n,k){if(t[n]){var i=t[n];t[n]=function(){k.apply(this,arguments),i.apply(this,arguments)}}else t[n]=function(){k.apply(this,arguments)}},jt:function(t,n,k){if(t[n]){var i=t[n];t[n]=function(t){var n=i.call(this,t);return k.call(this,t,n),n}}else t[n]=function(t){k.call(this,t)}},W:function(t){if(void 0!==t){if(this.ktongji=ktj,ktj.H="launch",ktj.x=t,ktj.P=t.path,ktj.ot(t),t.referrerInfo&&t.referrerInfo.extraData){var n=t.referrerInfo.extraData;t.referrerInfo.extraData="string"==typeof n?JSON.parse(n):n}if(ktj.d=ktj.at("ktj_src"),""==ktj.d){if(void 0!==t.query.ktj_src)ktj.d=t.query.ktj_src;else if(t.referrerInfo){n=t.referrerInfo.extraData;t.referrerInfo.extraData&&n.ktj_src?ktj.d=n.ktj_src:t.referrerInfo.appId&&(ktj.d=t.referrerInfo.appId)}""!=ktj.d&&ktj.rt("ktj_src",ktj.d)}else t.query.ktj_fsrc&&(ktj.d=t.query.ktj_src,ktj.rt("ktj_src",ktj.d));var k=function(){wx.getNetworkType({success:function(t){ktj.networkType=t.networkType},complete:i})},i=function(t){wx.getSetting&&wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?wx.getUserInfo({withCredentials:!1,fail:function(){},success:function(t){ktj.ut(t.userInfo),ktj.ht()}}):ktj.ht()}})};wx.getSystemInfo({success:function(t){ktj.I.dv=void 0===t.SDKVersion?"1.0.0":t.SDKVersion,ktj.I.md=t.model,ktj.I.po=t.pixelRatio,ktj.I.ww=t.windowWidth,ktj.I.wh=t.windowHeight,ktj.I.lg=t.language,ktj.I.wv=t.version,ktj.I.sv=t.system,ktj.I.pf=t.platform},complete:k})}},Z:function(t){if(void 0!==t){ktj.H="appshow",ktj.U=Date.now();var n=ktj.X({e:"_ktj_appshow",p:ktj.Y(t)});ktj.C?ktj.dt()&&ktj.z(n):ktj.z(n)}},$:function(){if(ktj.L=Date.now(),"shareapp"!=ktj.H){var t=ktj.X({e:"_ktj_apphide",p:{du:ktj.L-ktj.S,sdu:ktj.L-ktj.U}});ktj.z(t)}ktj.H="apphide"},tt:function(t){var n=ktj.X({e:"_ktj_apperror",p:{em:t},u:ktj.userInfo,si:ktj.I});ktj.z(n)},nt:function(t){ktj.y=this.route;var n=ktj.X({pp:ktj.T,e:"_ktj_pageload",ep:t});ktj.z(n)},kt:function(){this.ft=Date.now(),ktj.y=this.route;var t=ktj.X({pp:ktj.T,e:"_ktj_pageshow"});ktj.z(t)},it:function(){ktj.T=ktj.y;var t=ktj.X({e:"_ktj_pageexit",p:{du:Date.now()-this.ft}});ktj.z(t)},et:function(t,n){if(ktj.H="shareapp",ktj.O=Date.now(),void 0===n)return;var k="";k=""===ktj.d?ktj.h:ktj.d;const i=ktj.N();-1!=n.path.indexOf("?")?n.path+="&ktj_src="+k+"&ktj_fuid="+ktj.h+"&ktj_srid="+i:n.path+="?ktj_src="+k+"&ktj_fuid="+ktj.h+"&ktj_srid="+i;var j=ktj.X({e:"_ktj_shareapp",p:{c:k,srid:i}});return ktj.z(j),n},R:function(){this.h||(this.h=ktj.at("ktj_uid"),this.h||(ktj.h=ktj.N(),ktj.rt("ktj_uid",ktj.h)))},trackNavigateToMiniProgram:function(t){var n=ktj.X({e:"_ktj_tomp",p:{ai:t.appId,pt:t.path,ed:t.extraData},u:ktj.userInfo,si:ktj.I,lo:ktj.Y(ktj.x)});void 0!==t.openId&&(n.p.oi=t.openId),ktj.z(n)},ht:function(){var t=ktj.X({lp:ktj.P,e:"_ktj_launch",p:ktj.Y(ktj.x),u:ktj.userInfo,si:ktj.I});ktj.C?ktj.dt()&&ktj.z(t):ktj.z(t)},X:function(t){var n={k:ktj.J,t:ktj.o,v:ktj.a,s:ktj.A,i:ktj.h,cp:ktj.y,n:ktj.networkType,ts:Date.now()};return""!=ktj.d&&(n.c=ktj.d),""!=ktj.g&&(n.f=ktj.g),""!=ktj.l&&(n.fo=ktj.l),""!=ktj._&&(n.fu=ktj._),""!=ktj.w&&(n.srid=ktj.w),Object.assign(t,n)},z:function(t){if(!this.K||-1==this.M.indexOf(t.e)){var n=0,k=function(){n+=1,t.tc=n,wx.request({url:ktj.j,header:{"X-KYQ-SDK":"KTJ "+ktj.a+" "+ktj.J,"Content-Type":"application/json"},data:t,method:"POST",success:function(){},fail:function(){n<2&&(t.tc=n,k())}})};k()}},track:function(t,n){var k=ktj.X({e:"_ktj_ce",en:t,ep:n,u:ktj.userInfo,si:ktj.I});ktj.z(k)},ut:function(t){this.userInfo.nn=t.nickName,this.userInfo.gd=t.gender,this.userInfo.lg=t.language,this.userInfo.cy=t.city,this.userInfo.pe=t.province,this.userInfo.ct=t.country,this.userInfo.au=t.avatarUrl},ot:function(t){ktj.g=ktj.at("ktj_fuid"),ktj.w=ktj.at("ktj_srid"),t.query.openid&&(ktj.l=t.query.openid),t.query.ktj_uid&&(ktj._=t.query.ktj_uid),""==ktj.g&&(void 0!==t.query.ktj_fuid&&t.query.ktj_fuid!=ktj._&&(ktj.g=t.query.ktj_fuid),""!=ktj.g&&ktj.rt("ktj_fuid",ktj.g)),""==ktj.w&&(void 0!==t.query.ktj_srid&&(ktj.w=t.query.ktj_srid),""!=ktj.w&&ktj.rt("ktj_srid",ktj.w))},Y:function(t){var n={pt:t.path,qy:t.query,sn:t.scene};return t.shareTicket&&(n.st=t.shareTicket),t.referrerInfo&&(n.ri={ai:t.referrerInfo.appId,ed:t.referrerInfo.extraData}),n},at:function(t){var n="";try{n=wx.getStorageSync(t)}catch(t){}return n},rt:function(t,n){try{wx.setStorageSync(t,n)}catch(k){wx.setStorage({key:t,data:n,success:function(){},fail:function(){}})}},N:function(){return""+(new Date).getTime()+Math.floor(1e8*(1+Math.random()))},extractParams:function(t){var n={};let k=t.split("?")[1];return void 0!==k&&k.split("&").forEach(function(t){var k=t.split("=");n[k[0]]=decodeURIComponent(k[1])}),n},dt:function(){let t=ktj.F.split("?")[0];t="/"==t[0]?t.slice(1):t;let n=ktj.P.split("?")[0];return t===(n="/"==n[0]?n.slice(1):n)},appendUserIdToPath:function(t){let n=-1!=t.indexOf("ktj_src");return-1!=t.indexOf("?")?t+="&ktj_uid="+ktj.h:t+="?ktj_uid="+ktj.h,!n&&ktj.d&&(t+="&ktj_src="+ktj.d),t}};module.exports=ktj;